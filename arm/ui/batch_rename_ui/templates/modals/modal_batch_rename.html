<!-- Batch Rename Modal -->
<div class="modal fade" id="batchRenameModal" tabindex="-1" aria-labelledby="batchRenameModalTitle"
     aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dialog-scrollable">
        <div class="modal-content">
            <div class="modal-header bg-warning">
                <h5 class="modal-title" id="batchRenameModalTitle">Batch Rename Discs</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <!-- Step 1: Confirmation for non-series items -->
                <div id="rename-confirmation-step">
                    <div id="non-series-warning" class="alert alert-warning">
                        <h6><i class="fa fa-exclamation-triangle"></i> Warning: Non-TV Series Items Selected</h6>
                        <p>You have selected <strong id="non-series-count">0</strong> item(s) that are not marked as TV series.</p>
                        <p>Batch rename is optimized for TV series with disc labels (e.g., "BREAKING_BAD_S1D1"). 
                           Non-series items may not rename correctly and could use fallback naming.</p>
                        <div id="non-series-list" class="mt-2">
                            <!-- Populated by JavaScript -->
                        </div>
                        <hr>
                        <p class="mb-0"><strong>Do you want to continue with the batch rename operation?</strong></p>
                    </div>
                    <div class="text-right">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">
                            <i class="fa fa-times"></i> Cancel
                        </button>
                        <button type="button" class="btn btn-warning" id="confirm-continue-btn">
                            <i class="fa fa-check"></i> Yes, Continue
                        </button>
                    </div>
                </div>

                <!-- Step 2: Options -->
                <div id="rename-options-step" style="display: none;">
                    <h6 class="font-weight-bold">Rename Options</h6>
                    <div class="form-group">
                        <label for="naming-style">Naming Style:</label>
                        <select id="naming-style" class="form-control">
                            <option value="underscore" selected>Underscore (Breaking_Bad_S1D1)</option>
                            <option value="hyphen">Hyphen (breaking-bad-s1d1)</option>
                            <option value="space">Space (Breaking Bad S1D1)</option>
                        </select>
                    </div>
                    <div class="form-check">
                        <input type="checkbox" class="form-check-input" id="zero-padded">
                        <label class="form-check-label" for="zero-padded">
                            Zero-pad numbers (S01D01 instead of S1D1)
                        </label>
                    </div>
                    <div class="form-check">
                        <input type="checkbox" class="form-check-input" id="consolidate">
                        <label class="form-check-label" for="consolidate">
                            Consolidate into series parent folder (e.g., Breaking Bad (2008)/Breaking_Bad_S1D1/)
                        </label>
                    </div>
                    <div class="form-check">
                        <input type="checkbox" class="form-check-input" id="include-year" checked>
                        <label class="form-check-label" for="include-year">
                            Include year in series parent folder
                        </label>
                    </div>
                    <hr>
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="generate-preview-btn">
                        <i class="fa fa-eye"></i> Generate Preview
                    </button>
                </div>
                
                <!-- Step 3: Series Selection and Confirmation -->
                <div id="rename-series-selection-step" style="display: none;">
                    <h6 class="font-weight-bold">Series Detection and Confirmation</h6>
                    
                    <div id="series-detection-info" class="alert alert-info">
                        <strong>Multiple series detected.</strong> Please select which series name to use for batch rename.
                    </div>
                    
                    <div id="series-groups-container">
                        <!-- Populated by JavaScript with radio buttons for each detected series -->
                    </div>
                    
                    <div class="alert alert-warning mt-3" id="series-selection-warning">
                        <strong><i class="fa fa-exclamation-triangle"></i> Warning:</strong> All selected discs will be renamed using the series name you choose above.
                    </div>
                    
                    <div class="mt-3">
                        <div id="disc-assignment-container">
                            <!-- Populated by JavaScript -->
                        </div>
                    </div>
                    
                    <hr>
                    <button type="button" class="btn btn-secondary" id="back-from-series-btn">
                        <i class="fa fa-arrow-left"></i> Back to Options
                    </button>
                    <button type="button" class="btn btn-outline-secondary" data-dismiss="modal">
                        <i class="fa fa-times"></i> Cancel
                    </button>
                    <button type="button" class="btn btn-primary" id="confirm-series-btn">
                        <i class="fa fa-check"></i> Confirm and Preview
                    </button>
                </div>
                
                <!-- Step 4: Preview -->
                <div id="rename-preview-step" style="display: none;">
                    <h6 class="font-weight-bold">Preview Changes</h6>
                    <div id="preview-warnings" class="alert alert-warning" style="display: none;"></div>
                    <div id="preview-outliers" class="alert alert-info" style="display: none;"></div>
                    <div id="preview-conflicts" class="alert alert-danger" style="display: none;"></div>
                    
                    <div class="table-responsive">
                        <table class="table table-sm table-striped">
                            <thead>
                                <tr>
                                    <th>Job ID</th>
                                    <th>Title</th>
                                    <th>Label</th>
                                    <th>Old Folder</th>
                                    <th>New Folder</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="preview-table-body">
                                <!-- Populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                    
                    <hr>
                    <button type="button" class="btn btn-secondary" id="back-to-options-btn">
                        <i class="fa fa-arrow-left"></i> Back to Options
                    </button>
                    <button type="button" class="btn btn-success" id="execute-rename-btn">
                        <i class="fa fa-check"></i> Execute Batch Rename
                    </button>
                </div>
                
                <!-- Step 5: Progress/Results -->
                <div id="rename-results-step" style="display: none;">
                    <h6 class="font-weight-bold">Rename Results</h6>
                    
                    <div class="alert alert-info mb-3">
                        <i class="fa fa-info-circle"></i> 
                        <strong>Review your changes.</strong> If something isn't right, use the rollback button to undo this operation.
                        Close the modal and refresh the page to see updated file names.
                    </div>
                    
                    <div id="results-content"></div>
                    <hr>
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-warning" id="rollback-btn" style="display: none;">
                        <i class="fa fa-undo"></i> Rollback This Operation
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
